create database PENJUALANDVD;

use PENJUALANDVD;

CREATE TABLE KECAMATAN (
    ID_KECAMATAN SMALLINT,
    KECAMATAN VARCHAR(45),
    PRIMARY KEY (ID_KECAMATAN)
);

CREATE TABLE KELURAHAN (
    ID_KELURAHAN SMALLINT,
    ID_KECAMATAN SMALLINT,
    KELURAHAN VARCHAR(45),
    PRIMARY KEY (ID_KELURAHAN),
    FOREIGN KEY (ID_KECAMATAN) REFERENCES KECAMATAN(ID_KECAMATAN)
); 

CREATE TABLE GENRE (
    ID_GENRE SMALLINT,
    GENRE VARCHAR(45),
    PRIMARY KEY (ID_GENRE)
);

CREATE TABLE MOVIE (
    KODE_DVD VARCHAR(10),
    JUDUL VARCHAR(60),
    HARGA_SEWA DOUBLE,
    DENDA DOUBLE,
    TAHUN_RILIS SMALLINT,
    PRIMARY KEY (KODE_DVD)
);

ALTER TABLE MOVIE
MODIFY TAHUN_RILIS YEAR(4);

CREATE TABLE GENRE_MOVIE (
    ID_GENRE SMALLINT,
    KODE_DVD VARCHAR(10),
    FOREIGN KEY (ID_GENRE) REFERENCES GENRE(ID_GENRE),
    FOREIGN KEY (KODE_DVD) REFERENCES MOVIE(KODE_DVD),
    PRIMARY KEY (ID_GENRE, KODE_DVD)
);

CREATE TABLE PELANGGAN (
    KODE_PELANGGAN VARCHAR(10),
    ID_KELURAHAN SMALLINT,
    NAMA VARCHAR(45),
    ALAMAT VARCHAR(60),
    JENIS_KELAMIN CHAR(1) CHECK (JENIS_KELAMIN IN ('P', 'L')),
    PRIMARY KEY (KODE_PELANGGAN),
    FOREIGN KEY (ID_KELURAHAN) REFERENCES KELURAHAN(ID_KELURAHAN)
);

CREATE TABLE KONTAK_PELANGGAN (
    NO_HP VARCHAR(25),
    KODE_PELANGGAN VARCHAR(10),
    PRIMARY KEY (NO_HP),
    FOREIGN KEY (KODE_PELANGGAN) REFERENCES PELANGGAN(KODE_PELANGGAN)
);

CREATE TABLE TRANSAKSI (
    KODE_DVD VARCHAR(10),
    KODE_PELANGGAN VARCHAR(10),
    TANGGAL_SEWA DATE,
    TANGGAL_WAJIB_KEMBALI DATE,
    TANGGAL_REALISASI_KEMBALI DATE,
    FOREIGN KEY (KODE_DVD) REFERENCES MOVIE(KODE_DVD),
    FOREIGN KEY (KODE_PELANGGAN) REFERENCES PELANGGAN(KODE_PELANGGAN)
);
